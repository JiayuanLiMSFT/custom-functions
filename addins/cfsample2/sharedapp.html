<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge" />
		<meta http-equiv="Expires" content="0" />
		<title>Custom Functions Upgrade Test</title>
		<script src="https://unpkg.com/@microsoft/office-js@1.1.35-custom.0/dist/office.debug.js" type="text/javascript"></script>
		<script src="custom-functions.js" type="text/javascript"></script>
		<script type="text/javascript">
			var g_sharedAppData = {};
			var g_BgAppVisibilityState = {};

			function setSpanText(elementId, value) {
				var txt = document.createTextNode(value);
				var span = document.getElementById(elementId);
				if (span.hasChildNodes()) {
					span.removeChild(span.childNodes[0]);
				}
				span.appendChild(txt);
			}

			function appCmdUpdateSharedAppData(event) {
				g_sharedAppData.value = 2019;
				event.completed();
			}

			function BtnReadData() {
				setSpanText("SpanData", g_sharedAppData.value);
			}

			function BtnSetData() {
				var value = document.getElementById("TxtData").value;
				if (!value) {
					value = 2019;
				}

				g_sharedAppData.value = value;
			}

            function BtnShow() {
				SetRuntimeVisibleHelper(true);
			}
			
            function BtnHide() {
				SetRuntimeVisibleHelper(false);
            }
			
            function BtnGetRuntimeState() {
				return promiseWorkaround(function () {					
					// _getState() is the internal API and it's only for Microsoft engineer team internal testing purpose. Please do not use it.
					return OfficeRuntime.currentTaskpane._getState()
					.then(function (value) {
						setSpanText("SpanGetRuntimeState", value);
						return value;
					})
					.catch(function (error) {
						return error.code;
					});
				});
            }


			function BtnSetStartupBehaviorLoad() {
				SetStartupBehaviorHelper(OfficeRuntime.StartupBehavior.load);
			}

			function BtnSetStartupBehaviorNone() {
				SetStartupBehaviorHelper(OfficeRuntime.StartupBehavior.none);
			}
			
			function BtnGetStartupBehavior() {
				return promiseWorkaround(function () {
					return OfficeRuntime.currentTaskpane.getStartupBehavior()
					.then(function (value) {
						setSpanText("SpanGetStartupBehavior", value);
						return value;
					})
					.catch(function (error) {
						return error.code;
					});
				});
            }

			// App Commands
			function appCmdSetStateVisible(event) {
				SetRuntimeVisibleHelper(true);
				event.completed();   
			}
			
			function appCmdSetStateBackground(event) {
				SetRuntimeVisibleHelper(false);
				event.completed();
			}
			
			// Event handler
			Office.onReady(function() {
				OfficeRuntime.currentTaskpane.onVisibilityChanged.add(function(args) {
					g_BgAppVisibilityState.value = args.visibility;
					setSpanText("SpanVisiblityEventResult", args.visibility);
				});
			});
		</script>
	</head>
	<body>
		<div>
			Data
			<div>
				<button id="BtnSetData" onclick="BtnSetData()">SetData</button>: <input id="TxtData" type="text" />
			</div>
			<div>
				<button id="BtnReadData" onclick="BtnReadData()">ReadData</button>: <span id="SpanData"></span>
			</div>
		</div>
		<div>
			Visibility
			<div>
				<button id="BtnSetRuntimeState" onclick="BtnShow()">Show</button>
				<button id="BtnSetRuntimeState" onclick="BtnHide()">Hide</button>
			</div>
			<div>
				<button id="BtnGetRuntimeState" onclick="BtnGetRuntimeState()">GetRuntimeState</button>: <span id="SpanGetRuntimeState"></span>
			</div>
			<div>
				Visiblity Event Result: <span id="SpanVisiblityEventResult"></span>
			</div>
		</div>
		<div>
			Startup Behavior
			<div>
				<button id="BtnSetStartupBehaviorLoad" onclick="BtnSetStartupBehaviorLoad()">BtnSetStartupBehaviorLoad</button>
				<button id="BtnSetStartupBehaviorNone" onclick="BtnSetStartupBehaviorNone()">BtnSetStartupBehaviorNone</button>
			</div>
			<div>
				<button id="BtnGetStartupBehavior" onclick="BtnGetStartupBehavior()">BtnGetStartupBehavior</button>: <span id="SpanGetStartupBehavior"></span>
			</div>
		</div>
	</body>
</html>
